# Cloudflare Worker configuration for image delivery
# Deploy with: npx wrangler deploy

name = "heyyyydate-image-delivery"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Environment variables (set via wrangler secret put)
# IMAGE_TOKEN_SECRET - JWT secret for verifying image tokens (REQUIRED)
# R2_ACCESS_KEY_ID - R2 access key for generating presigned URLs (REQUIRED)
# R2_SECRET_ACCESS_KEY - R2 secret key for generating presigned URLs (REQUIRED)

# R2 Bucket bindings
# Character images (AI-generated, pre-made)
[[r2_buckets]]
binding = "IMAGES_BUCKET"
bucket_name = "character-images"

# User-uploaded images (avatars, chat photos)
[[r2_buckets]]
binding = "USER_IMAGES_BUCKET"
bucket_name = "user-images"

# Cached transformed images (blur, resize, format conversions)
[[r2_buckets]]
binding = "TRANSFORMED_IMAGES"
bucket_name = "character-images-transformed"

# Environment-specific configuration
[env.staging]
name = "heyyyydate-image-delivery-staging"
[[env.staging.r2_buckets]]
binding = "IMAGES_BUCKET"
bucket_name = "character-images"
[[env.staging.r2_buckets]]
binding = "USER_IMAGES_BUCKET"
bucket_name = "user-images"
[[env.staging.r2_buckets]]
binding = "TRANSFORMED_IMAGES"
bucket_name = "character-images-transformed"

[env.production]
name = "heyyyydate-image-delivery"
[[env.production.r2_buckets]]
binding = "IMAGES_BUCKET"
bucket_name = "character-images"
[[env.production.r2_buckets]]
binding = "USER_IMAGES_BUCKET"
bucket_name = "user-images"
[[env.production.r2_buckets]]
binding = "TRANSFORMED_IMAGES"
bucket_name = "character-images-transformed"

# Routes (uncomment when ready to deploy to custom domain)
# routes = [
#   { pattern = "images.heyyyydate.com/*", zone_name = "heyyyydate.com" }
# ]
